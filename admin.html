<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Engineer Ngendahimana Joseph</title>
        <link rel="stylesheet" href="styles/styles.css">
        <link href="https://fonts.googleapis.com/css?family=Zhi Mang Xing" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>
        <div class="main">
            <header>
                <div class="logo">
                    Engineer Ngendahimana Joseph
                </div>
                <div class="titles">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="contactme.html">Contact me</a></li>
                        <li><a href="profile.html">Profile</a></li>
                    </ul>
                </div>
            </header>
            <div>
                <hr class="bar">
            </div>
            <div class="content1">
                <div id="login_div" class="main-div">
                    <h3>Admin Login</h3>
                    <input type="email" placeholder="Email..." id="email_field"/>
                    <input type="password" placeholder="password..." id="password_field"/>
                    <button onclick="login()">Login</button>
                </div>
                <div id="user_div">
                    <div class="admin_view">
                        <cencter><h1 class="arti">My articles </h1></cencter>
                        <div class="articles"></div>
                        <div id="actions">
                            <input type="submit" value="View comments" id="comm" class="p">
             <input type="submit" value="Update Post" id="up" class="p">
             <input type="submit" value="Delete Post" id="del" class="p">
                        </div>
                        <div class="comment" >
                            <div id="visitors">
        
                            </div>
                            
                        </div>  
                        <div>
                           
                            <div>
                                <h1>Add update article</h1>
                                <p id="error" style="color: red;"></p>
                                <form id="adform" method="POST" autocomplete="off">
                                    <input id="name2" type="text" name="arttitle" placeholder="Enter the Title" required><br>
                                    <textarea name="details" id="message2" placeholder="Enter Details" required></textarea>
                                   <center> <input type="submit" name="title1" value="Post" id="submit2">
                                    <input type="button" name="title1" onclick="logout()" value="Logout" id="submit3">
                                </center>
        
                                </form>
                            </div>
                        </div> 
                    </div> 
                </div>              
                
            </div>
        </div>
        <script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-database.js"></script>
        <script id="mainScript">
             var firebaseConfig = {
                apiKey: "AIzaSyD1QVFIIVtj0F-ZaRVU2O0WPE2YvxrsIjU",
                authDomain: "ngenda-bfdfa.firebaseapp.com",
                databaseURL: "https://ngenda-bfdfa.firebaseio.com",
                projectId: "ngenda-bfdfa",
                storageBucket: "ngenda-bfdfa.appspot.com",
                messagingSenderId: "188708309095",
                appId: "1:188708309095:web:353bdc3955408c84762cc2"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
           
            //......................selection process............................

                
                    database=firebase.database();     
                var ref=database.ref('visitors');
                ref.on('value',gotData,errData);
                

                function gotData(data)
                {
                   var visits=data.val();
                   var keys=Object.keys(visits);
                   document.getElementById('visitors').innerHTML='<h1>Messages from visitors';
                   for(var i=0;i<keys.length;i++)
                   {
                       var k=keys[i];
                       var names=visits[k].Names;
                       var emailv=visits[k].emailv;
                       var datev=visits[k].datev;
                       var commentv=visits[k].commentv;
                       //console.log(names,emailv,datev,commentv);
                       document.getElementById('visitors').innerHTML+='<h3>'+names+' '+emailv+'</h3><p>'+commentv+'</p>'+'<h4>'+datev+'</h4>';
                   }
                }
                function errData(err)
                {
                    window.alert('error! '+err);
                }
                //get my posts and their comments
                const postsContainer = document.querySelector('.articles');
                
            (async () => {
        try {
          const res = await fetch(
            'http://localhost:3000/posts',
            {
              method: 'GET',
              headers: { 'content-Type': 'application/json' },
            },
          );
          const fetchedPosts = await res.json();
          const posts = fetchedPosts.data;
          console.log('posts:', posts.length);
          let html = '';
          var j=posts.length;
          var i=0;
          await posts.forEach((post) => {
            console.log(post);
            html += ` <div class="post-card">
         <div class="left-blog-card">
           <a href="readpost.html?id=${
             post._id
           }"><h3 class="post-title">
         ${post.title}</h3></a>
          
           <div class="bottom-icons">
             <p class="time"><em>Posted at ${post.createdAt}</em></p>
             <p class="time1"><em>${post.content}</em></p>
             <p class="each-icon">
               <i class="fa fa-commenting-o" aria-hidden="true"></i
               ><span class="right3"> ${post.commentsCount} comments</span>
               <i class="fa fa-eye" aria-hidden="true"></i>
               <span class="right3"> ${post.views} views</span>
               <i class="fa fa-heart" aria-hidden="true"></i>
               <span class="right3"> ${post.likes} likes</span>
             </p>
             
         <a href="deletepost.html?id=${
             post._id
           }"><h3 class="p">
         Delete Post</h3></a>
             
           </div>
           <div class="comments-container"></div>
         </div>
       </div>`;

       //view comments

          });
         
          postsContainer.innerHTML = html;
        } catch (error) {
          console.log(error);
        }
      })();
     
        </script>
        <script src="https://cdn.ckeditor.com/4.15.0/standard/ckeditor.js"></script>
        <script defer src="index.js"></script>
    </body>
</html>