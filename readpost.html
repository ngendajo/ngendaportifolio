<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Engineer Ngendahimana Joseph</title>
        <link rel="stylesheet" href="styles/styles.css">
        <link href="https://fonts.googleapis.com/css?family=Zhi Mang Xing" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
    </head>
    <body>
        <div class="main">
            <header>
                <div class="logo">
                    Engineer Ngendahimana Joseph
                </div>
                <div class="titles">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="contactme.html">Contact me</a></li>
                        <li><a href="profile.html">Profile</a></li>
                        <li><a href="admin.html">Admin</a></li>
                    </ul>
                   
                </div>
            </header>
            <div>
                <hr class="bar">
            </div>
            <div class="content1">
                <div class="post-read">

                </div>
                <a id="like"  style="color: darkcyan; text-decoration: none;" href="#"><strong class="like"style="position:relative;top:8px;"></strong> 
                    <i class="fa fa-thumbs-up" style="font-size:36px"></i></a>
                <h1>comments</h1>
                <div class="comments-container">

                </div>
                <div class="addcomments" style="padding-bottom: 3%;margin: auto;">
                    
                        <textarea id="message" class="comment-input" name="message" style="height:40px;width: 90%;" required placeholder="Leave your comment here"></textarea>
                        <input type="submit" name="submit" id="submit1" onclick="addComment()" value="Send">
                    
                    <a href="profile.html" id="submit1" style="text-decoration: none; margin-top: 1%;">Back to the list</a>
                    
                </div>
                
                
            </div>
        </div>
       
        <script>
            //Read one post
           const postRead = document.querySelector('.post-read');
      const commentsContainer = document.querySelector('.comments-container');
      const subInput = document.querySelector('.email-input');
      const postId = location.href.split('?id=')[1];

      (async () => {
        const res = await fetch(
          `https://ngendajo.herokuapp.com/post1/${postId}`,
        );
        const postData = await res.json();
        const post = postData.data;
        post.views += 1;

        let html = `
                <h2 class="title onRead-title">
                  ${post.title}
                </h2>
                <div class="onRead-post">
                  <p>
                    ${post.content}
                  </p>
                </div>
                `;
        document.querySelector('.like').textContent = post.likes;
        postRead.innerHTML = html;
      })();
      //Add comment
      var datev1,datev2,datev3,datev4,datev5,datev6,datev7;
    var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            var d = new Date();
                datev1=d.getFullYear();
                datev2=months[d.getMonth()];
                datev3=d.getDate();
                datev4=d.getHours();
                datev5=d.getMinutes();
                datev6=d.getSeconds();
                datev7=datev1+" "+datev2+" "+datev3+" "+datev4+":"+datev5+":"+datev6;
                function addComment() {
        const comment = document.querySelector('.comment-input');
        const allComments="allComments";
        comment.value.length > 0 &&
          (async () => {
            await fetch(
              `https://ngendajo.herokuapp.com/comments/${postId}/comment`,
              {
                method: 'post',
                headers: { 'content-Type': 'application/json' },
                body: JSON.stringify({
                  comment: comment.value,
                  createdAt: datev7,
                }),
              },
            );
            await location.reload();
          })();
        }
        //view comments
        (async () => {
        const res = await fetch(
          `https://ngendajo.herokuapp.com/comments/${postId}/allComments`,
        );
        const comments = await res.json();
        let html = '';
        comments.data.forEach((comment) => {
          html += `
           <div class="each-comment">
                  <div class="comment-details">
                    <p class="comment-time"> ${
                      comment.createdAt}</p>
                  </div>
                  <p class="commentPara">
                    ${comment.comment}
                  </p>
                </div>`;
        });
        commentsContainer.innerHTML = html;
      })();

      //likes
      const like = document.querySelector('#like');

      like.addEventListener('click', async () => {
        await fetch(
          `https://ngendajo.herokuapp.com/like/${postId}`,
          {
            method: 'put',
            headers: { 'content-Type': 'application/json' },
          },
        );
        location.reload();
      });
        </script>
        <script src="admin.js"></script>
    </body>
</html>