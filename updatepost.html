<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Engineer Ngendahimana Joseph</title>
        <link rel="stylesheet" href="styles/styles.css">
        <link href="https://fonts.googleapis.com/css?family=Zhi Mang Xing" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
    </head>
    <body>
        <div class="main">
            <header>
                <div class="logo">
                    Engineer Ngendahimana Joseph
                </div>
                <div class="titles">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="contactme.html">Contact me</a></li>
                        <li><a href="profile.html">Profile</a></li>
                    </ul>
                   
                </div>
            </header>
            <div>
                <hr class="bar">
            </div>
            <div class="content1">
                <div class="post-read">

                </div>
                <a id="like"  style="color: darkcyan; text-decoration: none;" href="#"><strong class="like"style="position:relative;top:8px;"></strong> 
                    <i class="fa fa-thumbs-up" style="font-size:36px"></i></a>
                
                <div class="comments-container">

                </div>
                <div class="addcomments" style="padding-bottom: 3%;margin: auto;">
                    
                  <form id="adform" method="POST" autocomplete="off">
                    <input id="name2" type="text" name="arttitle" placeholder="Enter the Title" required><br>
                    <textarea name="details" id="message2" placeholder="Enter Details" required></textarea>
                   <center> <input type="submit" name="title1" value="Post" id="submit2">
                </center>

                </form>
                </form>
                </div>
                
                
            </div>
        </div>
       
        <script>
            //Read one post
           const postRead = document.querySelector('.post-read');
      const commentsContainer = document.querySelector('.comments-container');
      const subInput = document.querySelector('.email-input');
      const postId = location.href.split('?id=')[1];
      

      (async () => {
        const res = await fetch(
          `http://localhost:3000/post1/${postId}`,
        );
        const postData = await res.json();
        const post = postData.data;
        post.views += 1;

        let html = `
                <h2 class="title onRead-title">
                  ${post.title}
                </h2>
                <div class="onRead-post">
                  <p>
                    ${post.content}
                  </p>
                </div>
                `;
        document.querySelector('.like').textContent = post.likes;
        postRead.innerHTML = html;
      })();
      

      //likes
      const like = document.querySelector('#like');

      like.addEventListener('click', async () => {
        await fetch(
          `http://localhost:3000/like/${postId}`,
          {
            method: 'put',
            headers: { 'content-Type': 'application/json' },
          },
        );
      });
      CKEDITOR.replace('details');
      const postForm = document.querySelector('#adform');
      postForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const fd = new FormData();
          fd.append('title', postForm.arttitle.value);
          fd.append('body', CKEDITOR.instances.details.getData());
          const res = await fetch(
            `https://http://localhost:3000/upost/${postId}`,
            {
              method: 'PATCH',
              headers: {},
              body: fd,
            },
          );
          const post = await res.json();
          console.log(post);

          // location.href = 'admin.html';
        } catch (error) {
          console.log(error);
        }
      });
        </script>
        <script src="https://cdn.ckeditor.com/4.15.0/standard/ckeditor.js"></script>
        <script src="admin.js"></script>
    </body>
</html>